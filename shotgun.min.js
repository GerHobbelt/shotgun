/*!
 * Name: shotgun.js
 * License: MIT
 * Version: 3.1
 * URL: https://github.com/jgnewman/shotgun
 */
(function(global){"use strict";var module=module||null,idIncrementor=999999,realEvents={},excludeItem={},eventDirs,internalEventDirs,output;function first(obj){return obj[0]}function last(obj){return obj[obj.length-1]}function lead(obj){return obj.slice(0,obj.length-1)}function idgen(){var newStr="",chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghiklmnopqrstuvwxyz",i;newStr+=(new Date).getTime();idIncrementor+=1;newStr+="-"+idIncrementor+"-";if(idIncrementor===9999999){idIncrementor=999999}for(i=0;i<25;i+=1){newStr+=chars[Math.floor(Math.random()*chars.length)]}return newStr}function map(obj,fun){var i,len=obj.length,output=[];for(i=0;i<len;i+=1){output.push(fun(obj[i],i))}return output}function chart(obj,fun){var i,item,output={};for(i in obj){if(Object.prototype.hasOwnProperty.call(obj,i)){item=fun(obj[i],i);if(item!==excludeItem){output[i]=item}}}return output}function Events(){}function InternalEvents(){}eventDirs=new Events;internalEventDirs=new InternalEvents;function evIsInternal(name){return name.slice(0,9)==="_internal"}function dirObject(name,parentDir,gotHereFromListen){var eventRef;if(parentDir===internalEventDirs&&gotHereFromListen){throw new Error("Attempt to subscribe to an internal event without first registering the event.")}eventRef=idgen();realEvents[eventRef]={};function Directory(){}Directory.prototype={_dirEvents:realEvents[eventRef],_dirEventsKey:eventRef,_parentDir:parentDir,_dirName:name};return new Directory}function invokeEvents(evDir,key,args,beRecursive){var events=evDir._dirEvents;if(key){events[key].apply(null,args);return true}chart(events,function(val){val.apply(null,args)});if(!beRecursive){return true}return chart(evDir,function(val,prop){if(first(prop)==="_"){return excludeItem}return invokeEvents(val,key,args,beRecursive)})}output={fire:function(ev,args,key){var eventArray,argArray,realKey,recursive,evDir;if(typeof args==="string"){argArray=[];realKey=args}else{argArray=args;realKey=key}if(evIsInternal(ev)){ev=ev.slice(10);evDir=internalEventDirs}else{evDir=eventDirs}if(last(ev)==="*"){recursive=true;eventArray=lead(lead(ev)).split("/")}else{eventArray=ev.split("/")}map(eventArray,function(each){evDir=evDir[each]});if(!evDir){return false}return invokeEvents(evDir,realKey,argArray,recursive)},listen:function(ev,fn,key){var realKey=key||idgen(),evArray,parentDir;if(evIsInternal(ev)){ev=ev.slice(10);parentDir=internalEventDirs}else{parentDir=eventDirs}evArray=ev.split("/");map(evArray,function(each){parentDir[each]=parentDir[each]||dirObject(each,parentDir,true);parentDir=parentDir[each]});parentDir._dirEvents[realKey]=fn;this.fire("_internal/newListener",[ev,fn,realKey]);return realKey},registerInternal:function(){map(arguments,function(arg){var evDir=internalEventDirs,evArray=arg.split("/");map(evArray,function(each){evDir[each]=evDir[each]||dirObject(each,evDir,false);evDir=evDir[each]})});return true},remove:function(ev,key){var eventArray,evDir;if(evIsInternal(ev)){ev=ev.slice(10);evDir=internalEventDirs}else{evDir=eventDirs}eventArray=ev.split("/");map(eventArray,function(each){evDir=evDir[each]});if(key){delete evDir._dirEvents[key];this.fire("_internal/rmListener",[ev,key]);return true}delete realEvents[evDir._dirEventsKey];delete evDir._parentDir[evDir._dirName];this.fire("_internal/rmEvent",[ev]);return true},attempt:function(ev,fn,key){var realEvent,realFn,realKey;if(typeof ev==="function"){realFn=ev;realKey=fn}else{realEvent=ev;realFn=fn;realKey=key}try{realFn()}catch(err){if(realEvent){this.fire(realEvent,[err,realFn],realKey)}this.fire("_internal/tryError",[err,realFn],realKey)}},getEvents:function(){return eventDirs},getInternalEvents:function(){return internalEventDirs},docReady:function(fun){this.listen("docReady",fun)}};output.registerInternal("newListener","rmEvent","rmListener","tryError");function fireDocReady(){if(/in/.test(global.document.readyState)){return global.setTimeout(fireDocReady,100)}return output.fire("docReady")}if(global.constructor.name==="Window"){fireDocReady()}if(global.define&&typeof global.define==='function'&&global.define.amd){global.define("SHOTGUN",[],output)}else if(module&&module.exports){module.exports=output}else{global.SHOTGUN=global.SG=output}})(this)